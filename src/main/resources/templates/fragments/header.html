<div th:fragment="common-header">
	<header>
		<div class="header-wrapper">
			<div class="header-container">
				<!--* 로고 영역 /-->
				<h1 class="logo">
					<a th:href="@{/}">
						<img th:src="@{/images/logo/logo.svg}" alt="로고">
					</a>
				</h1>
				<!--* 메인 내비게이션 /-->
				<nav aria-label="메인 메뉴">
					<ul>
						<li><a th:href="@{/products}">중고거래</a></li>
						<li sec:authorize="isAuthenticated()">
							<a th:href="@{/location}">동네인증</a>
						</li>
					</ul>
				</nav>
			</div>

			<!--* 검색 + 사용자 관련 버튼 /-->
			<div class="header-actions" aria-label="사용자 메뉴">
				<!--* 상품 경로 제대로 정해지면 변경하기 /-->
				<form class="form-group" th:action="@{/products/search}" method="get"
					  role="search" aria-label="상품 검색">
					<input id="search" name="keyword" type="search" placeholder="물품이나 동네를 검색해보세요">
					<button type="submit" style="display: none"></button> <!--* 엔터 제출 보장용 /-->
				</form>

				<!--* 로그인한 사용자에게 드롭다운 메뉴 표시 /-->
				<div sec:authorize="isAuthenticated()" class="user-dropdown">
					<div class="user-welcome" onclick="toggleDropdown(event)">
						<span class="welcome-text">어서오세요</span>
						<span class="user-name" th:text="${session.user?.userName} ?: '사용자'">닉네임</span>
						<span class="welcome-text">님</span>
						<svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="dropdown-arrow">
							<path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
						</svg>
					</div>
					<div class="dropdown-menu">
						<a th:href="@{/chats}" class="dropdown-item">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<path d="M8 12H8.01M12 12H12.01M16 12H16.01M21 12C21 16.418 16.97 20 12 20C10.58 20 9.2 19.66 8 19.05L3 20L4.95 16C4.34 14.8 4 13.42 4 12C4 7.582 8.03 4 12 4C16.97 4 21 7.582 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							채팅하기
						</a>
						<a th:href="@{/profile}" class="dropdown-item">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							프로필
						</a>
						<hr class="dropdown-divider">
						<form class="dropdown-logout-form" th:action="@{/logout}" method="post">
							<button type="submit" class="dropdown-item logout-item">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
									<path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
								</svg>
								로그아웃
							</button>
						</form>
					</div>
				</div>

				<script>
					function toggleDropdown(event) {
                        event.preventDefault();
                        event.stopPropagation();
                        const dropdown = event.currentTarget.closest('.user-dropdown');
                        dropdown.classList.toggle('active');
                    }

                    // 외부 클릭시 닫기
                    document.addEventListener('click', function(e) {
                        const dropdown = document.querySelector('.user-dropdown');
                        if (dropdown && !dropdown.contains(e.target)) {
                            dropdown.classList.remove('active');
                        }
                    });
				</script>

				<!--* 로그인 하지 않은 사용자에게만 '로그인' 버튼 표시/-->
				<div sec:authorize="isAnonymous()">
					<a th:href="@{/login}" class="btn-main btn-login">로그인</a>
				</div>
			</div>
		</div>
	</header>
</div>